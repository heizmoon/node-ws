<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>魔法少女契约书 - Magical Girl Covenant</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500;700&family=Noto+Serif+JP:wght@500;700&display=swap');

        :root {
            --primary-pink: #ff85a2;
            --deep-purple: #0d0221;
            --accent-gold: #ffd700;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #0d0221;
            color: #fff;
            font-family: 'Noto Serif SC', 'Noto Serif JP', serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="%23ff85a2" stroke="%23fff" stroke-width="1.5" d="M24.5,2.5 L29.5,7.5 L12,25 L7,20 L24.5,2.5 Z M2,30 L5,27 L8,30 L5,33 Z" /><circle cx="5" cy="30" r="2" fill="%23ffd700"/></svg>') 0 32, auto;
        }

        /* 背景容器，用于处理本地图失败回退AI图 */
        #bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease;
        }

        h1 {
            font-size: 3rem;
            margin: 40px 0 10px 0;
            text-align: center;
            background: linear-gradient(to bottom, #fff, var(--primary-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px var(--primary-pink));
            letter-spacing: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        h1:hover {
            filter: drop-shadow(0 0 25px var(--accent-gold));
            transform: scale(1.05);
        }

        .subtitle {
            font-size: 0.9rem;
            margin-bottom: 40px;
            color: var(--accent-gold);
            opacity: 0.8;
            letter-spacing: 2px;
            animation: fadeInOut 2s infinite;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.9; } }

        .character-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
            padding: 20px;
            z-index: 2;
        }

        .char-card {
            position: relative;
            width: 260px;
            height: 380px;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            cursor: pointer;
        }

        .loading::after {
            content: "召唤中...";
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.7);
            color: var(--primary-pink);
            font-weight: bold;
            z-index: 20;
            animation: pulse 1s infinite;
        }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .img-wrapper {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1a1a1a;
        }

        .char-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.8);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .char-img.loaded { opacity: 1; }

        .char-card:hover { transform: translateY(-20px); border-color: var(--primary-pink); box-shadow: 0 0 40px var(--primary-pink); }
        .char-card:hover .char-img { transform: scale(1.1); filter: brightness(1.1); }

        .magic-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 320px;
            background: url('https://image.pollinations.ai/prompt/simple%20white%20magic%20summoning%20circle%20geometric%20pattern%20black%20background?width=512&height=512&nologo=true&seed=1') no-repeat center;
            background-size: contain;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            mix-blend-mode: screen;
            pointer-events: none;
            z-index: 5;
            transition: all 0.5s ease;
        }

        .char-card:hover .magic-circle {
            opacity: 0.8;
            transform: translate(-50%, -50%) scale(0.85) rotate(360deg);
            animation: spin 15s linear infinite;
        }

        @keyframes spin { to { transform: translate(-50%, -50%) scale(0.85) rotate(360deg); } }

        .particles { position: absolute; inset: 0; pointer-events: none; z-index: 6; }
        .p { position: absolute; bottom: -10px; background: #fff; border-radius: 50%; opacity: 0; }
        .char-card:hover .p { animation: rise 2s ease-out infinite; }
        @keyframes rise { 0% { transform: translateY(0); opacity: 0; } 30% { opacity: 0.8; } 100% { transform: translateY(-250px); opacity: 0; } }

        #magic-display {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 250px;
            background: rgba(13, 2, 33, 0.95);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            border-top: 2px solid var(--primary-pink);
            z-index: 100;
        }

        #magic-display.show { transform: translateY(0); }
        .display-content { display: flex; align-items: center; max-width: 1000px; width: 90%; gap: 40px; }
        .crest-box { width: 150px; height: 150px; }
        .crest-img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 0 10px var(--primary-pink)); }
        .info-box { flex-grow: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 30px; }
        .info-col h2 { color: var(--primary-pink); margin: 0 0 10px 0; }
        .close-btn { position: absolute; top: 20px; right: 30px; cursor: pointer; font-size: 30px; }

    </style>
</head>
<body>

    <div id="bg-overlay"></div>
    <h1 id="summon-title">✨ 魔法少女契約書 ✨</h1>
    <div class="subtitle">( 点击标题召唤全新的命运 )</div>

    <div class="character-container" id="card-container"></div>

    <div id="magic-display">
        <div class="close-btn" onclick="hideDetails()">×</div>
        <div class="display-content">
            <div class="crest-box"><img id="d-crest" src="" class="crest-img"></div>
            <div class="info-box">
                <div class="info-col"><h2 id="d-name"></h2><p id="d-desc"></p></div>
                <div class="info-col"><h2 id="d-name-jp" style="font-family: 'Noto Serif JP';"></h2><p id="d-desc-jp" style="font-family: 'Noto Serif JP';"></p></div>
            </div>
        </div>
    </div>

    <script>
        // 丰富的角色随机库
        const namePool = [
            { cn: "月咏 · 祈丽", jp: "月詠 · イノリ", attr: "月光", hue: 260, prompt: "moonlight silver hair purple eyes crescent moon staff" },
            { cn: "星宫 · 璃乃", jp: "星宮 · りの", attr: "星辰", hue: 200, prompt: "starry hair blue dress constellations magic" },
            { cn: "樱华 · 萌波", jp: "桜華 · もなみ", attr: "樱花", hue: 330, prompt: "cherry blossom petals pink kimono-style dress" },
            { cn: "雷鸣 · 凛卡", jp: "雷鳴 · リンカ", attr: "雷电", hue: 50, prompt: "yellow lightning electric sparks confident expression" },
            { cn: "深海 · 汐里", jp: "深海 · しおり", attr: "海洋", hue: 180, prompt: "underwater theme bubbles blue long hair jellyfish dress" },
            { cn: "冥途 · 尤娜", jp: "冥途 · ユナ", attr: "幽冥", hue: 280, prompt: "gothic lolita dark magic shadowy aura butterfly wings" }
        ];

        const descPool = [
            { cn: "拥有操控{attr}的契约之力，立志要将这个世界从黑暗中拯救。", jp: "{attr}を操る契約の力を持ち、世界を闇から救うことを誓う。" },
            { cn: "被{attr}所选中的少女，在寂静的夜里守护着城市。必杀技是「{attr}冲击」。", jp: "{attr}に選ばれし少女。静かな夜に街を守り続ける。必殺技は「{attr}インパクト」。" },
            { cn: "作为{attr}的使徒，她冷峻的外表下藏着一颗温柔的心。", jp: "{attr}の使徒として、クールな外見の裏に優しい心を持っている。" }
        ];

        const bgOverlay = document.getElementById('bg-overlay');
        const container = document.getElementById('card-container');
        const title = document.getElementById('summon-title');

        // 初始化背景
        function initBackground() {
            const localBg = 'images/bg.jpg';
            const aiBg = 'https://image.pollinations.ai/prompt/anime%20scenery%20starry%20night%20sky%20nebula%20dreamlike?width=1920&height=1080&nologo=true&seed=123';
            
            const tempImg = new Image();
            tempImg.src = localBg;
            tempImg.onload = () => { bgOverlay.style.backgroundImage = `url(${localBg})`; };
            tempImg.onerror = () => { bgOverlay.style.backgroundImage = `url(${aiBg})`; };
        }

        // 创建随机角色数据
        function getRandomChar(id) {
            const base = namePool[Math.floor(Math.random() * namePool.length)];
            const descTpl = descPool[Math.floor(Math.random() * descPool.length)];
            return {
                id: id,
                name: base.cn,
                nameJp: base.jp,
                hue: base.hue,
                prompt: `anime girl magical girl ${base.prompt} masterpiece 2d highres`,
                desc: descTpl.cn.replace(/{attr}/g, base.attr),
                descJp: descTpl.jp.replace(/{attr}/g, base.attr),
                localImg: `images/char${id}.jpg`
            };
        }

        let currentChars = [];

        // 初始化/刷新卡片
        async function refreshCards(isAI = false) {
            container.innerHTML = '';
            currentChars = [];
            
            for (let i = 1; i <= 3; i++) {
                const charData = getRandomChar(i);
                currentChars.push(charData);

                const card = document.createElement('div');
                card.className = 'char-card';
                card.id = `card-${i}`;
                card.innerHTML = `
                    <div class="img-wrapper">
                        <img id="img-${i}" class="char-img">
                    </div>
                    <div class="magic-circle" style="filter: hue-rotate(${charData.hue}deg) brightness(1.5);"></div>
                    <div class="particles">
                        ${Array(5).fill(0).map((_, pidx) => `<div class="p" style="left:${20+pidx*15}%; animation-delay:${pidx*0.3}s; width:4px; height:4px;"></div>`).join('')}
                    </div>
                `;
                container.appendChild(card);

                const img = document.getElementById(`img-${i}`);
                
                if (isAI) {
                    // AI 召唤逻辑
                    card.classList.add('loading');
                    const seed = Math.floor(Math.random() * 99999);
                    const aiUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(charData.prompt)}?width=400&height=600&nologo=true&seed=${seed}`;
                    
                    img.src = aiUrl;
                    img.onload = () => { img.classList.add('loaded'); card.classList.remove('loading'); };
                    img.onerror = () => { img.src = charData.localImg; card.classList.remove('loading'); };
                    
                    card.onclick = () => showDetails(charData, aiUrl);
                } else {
                    // 默认加载逻辑：先试本地，不行再AI
                    img.src = charData.localImg;
                    img.onload = () => img.classList.add('loaded');
                    img.onerror = () => {
                        const seed = 888 + i;
                        const aiUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(charData.prompt)}?width=400&height=600&nologo=true&seed=${seed}`;
                        img.src = aiUrl;
                        img.onload = () => img.classList.add('loaded');
                    };
                    card.onclick = () => showDetails(charData, img.src);
                }
                
                // 稍微错开AI召唤的请求时间
                if (isAI) await new Promise(r => setTimeout(r, 800));
            }
        }

        function showDetails(char, currentImg) {
            document.getElementById('d-crest').src = `https://image.pollinations.ai/prompt/magic%20crest%20emblem%20isolated%20on%20black?nologo=true&seed=${char.hue}`;
            document.getElementById('d-crest').style.filter = `hue-rotate(${char.hue}deg) brightness(2)`;
            document.getElementById('d-name').innerText = char.name;
            document.getElementById('d-name-jp').innerText = char.nameJp;
            document.getElementById('d-desc').innerText = char.desc;
            document.getElementById('d-desc-jp').innerText = char.descJp;
            document.getElementById('magic-display').classList.add('show');
        }

        function hideDetails() { document.getElementById('magic-display').classList.remove('show'); }

        title.addEventListener('click', () => refreshCards(true));

        window.onload = () => {
            initBackground();
            refreshCards(false);
        };
    </script>
</body>
</html>
